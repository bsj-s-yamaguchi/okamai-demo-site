# Demo Site - 埋め込まれるサイト (開発用)
FROM node:24-alpine

WORKDIR /var/www/demo-site

# タイムゾーン設定とbashのインストール
RUN apk --no-cache add tzdata curl bash && \
    cp /usr/share/zoneinfo/Asia/Tokyo /etc/localtime && \
    apk del tzdata

# bunのインストール
RUN curl -fsSL https://bun.sh/install | bash
ENV PATH="/root/.bun/bin:${PATH}"

# 依存関係のコピーとインストール
COPY package*.json ./
RUN bun install --frozen-lockfile || bun install

# ソースコードのコピー
COPY . .

# 開発環境用の設定
ENV NODE_ENV=development
ENV NEXT_TELEMETRY_DISABLED=1
ENV CHOKIDAR_USEPOLLING=true
ENV CHOKIDAR_INTERVAL=500
ENV WATCHPACK_POLLING=true
ENV WATCHPACK_AGGREGATE_TIMEOUT=200

# ポート3000を公開
EXPOSE 3000

# 開発用コマンド（ホットリロード）
CMD ["bun", "run", "dev"] 